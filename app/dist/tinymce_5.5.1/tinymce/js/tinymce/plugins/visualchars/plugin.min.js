!function(){"use strict";var n,t,e,o,r,i,u=tinymce.util.Tools.resolve("tinymce.PluginManager"),c=function(n){return function(){return n}},a=c(!1),s=c(!0),f=function(){return l},l=(n=function(n){return n.isNone()},{fold:function(n,t){return n()},is:a,isSome:a,isNone:s,getOr:e=function(n){return n},getOrThunk:t=function(n){return n()},getOrDie:function(n){throw new Error(n||"error: getOrDie called on none.")},getOrNull:c(null),getOrUndefined:c(void 0),or:e,orThunk:t,map:f,each:function(){},bind:f,exists:a,forall:s,filter:f,equals:n,equals_:n,toArray:function(){return[]},toString:c("none()")}),d=function(n){var t=c(n),e=function(){return r},o=function(t){return t(n)},r={fold:function(t,e){return e(n)},is:function(t){return n===t},isSome:s,isNone:a,getOr:t,getOrThunk:t,getOrDie:t,getOrNull:t,getOrUndefined:t,or:e,orThunk:e,map:function(t){return d(t(n))},each:function(t){t(n)},bind:o,exists:o,forall:o,filter:function(t){return t(n)?r:l},toArray:function(){return[n]},toString:function(){return"some("+n+")"},equals:function(t){return t.is(n)},equals_:function(t,e){return t.fold(a,(function(t){return e(n,t)}))}};return r},m=function(n){return null===n||void 0===n?l:d(n)},v=function(n){return function(t){return typeof t===n}},g=(o="string",function(n){return e=typeof(t=n),(null===t?"null":"object"==e&&(Array.prototype.isPrototypeOf(t)||t.constructor&&"Array"===t.constructor.name)?"array":"object"==e&&(String.prototype.isPrototypeOf(t)||t.constructor&&"String"===t.constructor.name)?"string":e)===o;var t,e}),h=v("boolean"),p=v("number"),y=function(n,t){for(var e=0,o=n.length;e<o;e++)t(n[e],e)},b=Object.keys,w=function(n,t){for(var e=b(n),o=0,r=e.length;o<r;o++){var i=e[o];t(n[i],i)}},N=("undefined"!=typeof window||Function("return this;")(),function(n){return n.dom.nodeValue}),T=(r=3,function(n){return n.dom.nodeType===r}),k=function(n,t,e){!function(n,t,e){if(!(g(e)||h(e)||p(e)))throw console.error("Invalid call to Attribute.set. Key ",t,":: Value ",e,":: Element ",n),new Error("Attribute value was not simple");n.setAttribute(t,e+"")}(n.dom,t,e)},A=function(n,t){n.dom.removeAttribute(t)},O=function(n,t){var e,o,r=(e=t,null===(o=n.dom.getAttribute(e))?void 0:o);return void 0===r||""===r?[]:r.split(" ")},C=function(n){return void 0!==n.dom.classList},S=function(n,t){return r=t,i=O(e=n,o="class").concat([r]),k(e,o,i.join(" ")),!0;var e,o,r,i},D=function(n,t){return r=t,0<(i=function(n,t){for(var e=[],o=0,r=n.length;o<r;o++){var i=n[o];t(i,o)&&e.push(i)}return e}(O(e=n,o="class"),(function(n){return n!==r}))).length?k(e,o,i.join(" ")):A(e,o),!1;var e,o,r,i},E=function(n){0===(C(n)?n.dom.classList:O(n,"class")).length&&A(n,"class")},L=function(n){if(null===n||void 0===n)throw new Error("Node cannot be null or undefined");return{dom:n}},x={fromHtml:function(n,t){var e=(t||document).createElement("div");if(e.innerHTML=n,!e.hasChildNodes()||1<e.childNodes.length)throw console.error("HTML does not have a single root node",n),new Error("HTML must have a single root node");return L(e.childNodes[0])},fromTag:function(n,t){var e=(t||document).createElement(n);return L(e)},fromText:function(n,t){var e=(t||document).createTextNode(n);return L(e)},fromDom:L,fromPoint:function(n,t,e){return m(n.dom.elementFromPoint(t,e)).map(L)}},V={"\xa0":"nbsp","\xad":"shy"},B=function(n,t){var e="";return w(n,(function(n,t){e+=t})),new RegExp("["+e+"]",t?"g":"")},P=B(V),_=B(V,!0),j=(i="",w(V,(function(n){i&&(i+=","),i+="span.mce-"+n})),i),M="mce-nbsp",q=function(n){return'<span data-mce-bogus="1" class="mce-'+V[n]+'">'+n+"</span>"},H=function(n){var t=N(n);return T(n)&&void 0!==t&&P.test(t)},F=function(n,t){var e=[],o=function(n,t){for(var e=n.length,o=new Array(e),r=0;r<e;r++){var i=n[r];o[r]=t(i,r)}return o}(n.dom.childNodes,x.fromDom);return y(o,(function(n){t(n)&&(e=e.concat([n])),e=e.concat(F(n,t))})),e},I=function(n){return"span"===n.nodeName.toLowerCase()&&n.classList.contains("mce-nbsp-wrap")},U=function(n,t){var e=F(x.fromDom(t),H);y(e,(function(t){var e,o,r=t.dom.parentNode;if(I(r))e=x.fromDom(r),o=M,C(e)?e.dom.classList.add(o):S(e,o);else{for(var i=n.dom.encode(N(t)).replace(_,q),u=n.dom.create("div",null,i),c=void 0;c=u.lastChild;)n.dom.insertAfter(c,t.dom);n.dom.remove(t.dom)}}))},K=function(n,t){var e=n.dom.select(j,t);y(e,(function(t){var e,o;I(t)?(e=x.fromDom(t),o=M,C(e)?e.dom.classList.remove(o):D(e,o),E(e)):n.dom.remove(t,!0)}))},R=function(n){var t=n.getBody(),e=n.selection.getBookmark(),o=void 0!==(o=function(n,t){for(;n.parentNode;){if(n.parentNode===t)return n;n=n.parentNode}}(n.selection.getNode(),t))?o:t;K(n,o),U(n,o),n.selection.moveToBookmark(e)},z=function(n,t){var e,o,r=n.getBody(),i=n.selection;t.set(!t.get()),e=n,o=t.get(),e.fire("VisualChars",{state:o});var u=i.getBookmark();(!0===t.get()?U:K)(n,r),i.moveToBookmark(u)},G=tinymce.util.Tools.resolve("tinymce.util.Delay"),J=function(n,t){return function(e){e.setActive(t.get());var o=function(n){return e.setActive(n.state)};return n.on("VisualChars",o),function(){return n.off("VisualChars",o)}}};u.add("visualchars",(function(n){var t,e,o,r,i,u,c,a,s,f,l,d=(t=!1,{get:function(){return t},set:function(n){t=n}});return o=d,(e=n).addCommand("mceVisualChars",(function(){z(e,o)})),i=d,(r=n).ui.registry.addToggleButton("visualchars",{tooltip:"Show invisible characters",icon:"visualchars",onAction:function(){return r.execCommand("mceVisualChars")},onSetup:J(r,i)}),r.ui.registry.addToggleMenuItem("visualchars",{text:"Show invisible characters",icon:"visualchars",onAction:function(){return r.execCommand("mceVisualChars")},onSetup:J(r,i)}),u=n,c=d,a=G.debounce((function(){R(u)}),300),!1!==u.getParam("forced_root_block")&&u.on("keydown",(function(n){!0===c.get()&&(13===n.keyCode?R(u):a())})),f=d,(s=n).on("init",(function(){var n=!s.getParam("visualchars_default_state",!1);f.set(n),z(s,f)})),l=d,{isEnabled:function(){return l.get()}}}))}();