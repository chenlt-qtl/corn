!function(){"use strict";var n,t,e,o,r=tinymce.util.Tools.resolve("tinymce.PluginManager"),i=function(){return(i=Object.assign||function(n){for(var t,e=1,o=arguments.length;e<o;e++)for(var r in t=arguments[e])Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r]);return n}).apply(this,arguments)},u=function(n){var t=n;return{get:function(){return t},set:function(n){t=n}}},a=Object.prototype.hasOwnProperty,c=function(){for(var t=new Array(arguments.length),e=0;e<t.length;e++)t[e]=arguments[e];if(0===t.length)throw new Error("Can't merge zero objects");for(var o={},r=0;r<t.length;r++){var i=t[r];for(var u in i)a.call(i,u)&&(o[u]=n(o[u],i[u]))}return o},l=function(n){return function(){return n}},s=l(!(n=function(n,t){return t})),f=l(!0),m=function(){return g},g=(t=function(n){return n.isNone()},{fold:function(n,t){return n()},is:s,isSome:s,isNone:f,getOr:o=function(n){return n},getOrThunk:e=function(n){return n()},getOrDie:function(n){throw new Error(n||"error: getOrDie called on none.")},getOrNull:l(null),getOrUndefined:l(void 0),or:o,orThunk:e,map:m,each:function(){},bind:m,exists:s,forall:f,filter:m,equals:t,equals_:t,toArray:function(){return[]},toString:l("none()")}),d=function(n){var t=l(n),e=function(){return r},o=function(t){return t(n)},r={fold:function(t,e){return e(n)},is:function(t){return n===t},isSome:f,isNone:s,getOr:t,getOrThunk:t,getOrDie:t,getOrNull:t,getOrUndefined:t,or:e,orThunk:e,map:function(t){return d(t(n))},each:function(t){t(n)},bind:o,exists:o,forall:o,filter:function(t){return t(n)?r:g},toArray:function(){return[n]},toString:function(){return"some("+n+")"},equals:function(t){return t.is(n)},equals_:function(t,e){return t.fold(s,(function(t){return e(n,t)}))}};return r},y={some:d,none:m,from:function(n){return null===n||void 0===n?g:d(n)}},v=Object.keys,h=Object.hasOwnProperty,p=function(n,t){for(var e=v(n),o=0,r=e.length;o<r;o++){var i=e[o];t(n[i],i)}},b=function(n,t){var e={};return p(n,(function(n,o){var r=t(n,o);e[r.k]=r.v})),e},w=tinymce.util.Tools.resolve("tinymce.Resource"),O=tinymce.util.Tools.resolve("tinymce.util.Delay"),C=tinymce.util.Tools.resolve("tinymce.util.Promise"),k="All",j={symbols:"Symbols",people:"People",animals_and_nature:"Animals and Nature",food_and_drink:"Food and Drink",activity:"Activity",travel_and_places:"Travel and Places",objects:"Objects",flags:"Flags",user:"User Defined"},A=function(n,t){return e=n,o=t,h.call(e,o)?n[t]:t;var e,o},T=function(n){var t,e=n.getParam("emoticons_append",{},"object");return t=function(n){return i({keywords:[],category:"user"},n)},b(e,(function(n,e){return{k:e,v:t(n,e)}}))},_=function(n,t,e){var o=u(y.none()),r=u(y.none());n.on("init",(function(){w.load(e,t).then((function(t){var e,i,u,a=T(n);e=c(t,a),i={},u=[],p(e,(function(n,t){var e={title:t,keywords:n.keywords,char:n["char"],category:A(j,n.category)},o=void 0!==i[e.category]?i[e.category]:[];i[e.category]=o.concat([e]),u.push(e)})),o.set(y.some(i)),r.set(y.some(u))}),(function(n){console.log("Failed to load emoticons: "+n),o.set(y.some({})),r.set(y.some([]))}))}));var i=function(){return r.get().getOr([])},a=function(){return o.get().isSome()&&r.get().isSome()};return{listCategories:function(){return[k].concat(v(o.get().getOr({})))},hasLoaded:a,waitForLoad:function(){return a()?C.resolve(!0):new C((function(n,e){var o=15,r=O.setInterval((function(){a()?(O.clearInterval(r),n(!0)):--o<0&&(console.log("Could not load emojis from url: "+t),O.clearInterval(r),e(!1))}),100)}))},listAll:i,listCategory:function(n){return n===k?i():o.get().bind((function(t){return y.from(t[n])})).getOr([])}}},D=function(n,t){return-1!==n.indexOf(t)},P=function(n,t,e){for(var o=[],r=t.toLowerCase(),i=e.fold((function(){return s}),(function(n){return function(t){return n<=t}})),u=0;u<n.length&&(0!==t.length&&!function(n,t){return D(n.title.toLowerCase(),t)||function(n,t){for(var e=0,o=n.length;e<o;e++)if(t(n[e],e))return!0;return!1}(n.keywords,(function(n){return D(n.toLowerCase(),t)}))}(n[u],r)||(o.push({value:n[u]["char"],text:n[u].title,icon:n[u]["char"]}),!i(o.length)));u++);return o},x="pattern",L=function(n,t){var e,o,r,i={pattern:"",results:P(t.listAll(),"",y.some(300))},a=u(k),c=(e=function(n){var e,o,r,i,u;o=(e=n).getData(),r=a.get(),i=t.listCategory(r),u=P(i,o[x],r===k?y.some(300):y.none()),e.setData({results:u})},o=200,r=null,{cancel:function(){null!==r&&(clearTimeout(r),r=null)},throttle:function(){for(var n=[],t=0;t<arguments.length;t++)n[t]=arguments[t];null!==r&&clearTimeout(r),r=setTimeout((function(){e.apply(null,n),r=null}),o)}}),l={label:"Search",type:"input",name:x},s={type:"collection",name:"results"},f=function(){return{title:"Emoticons",size:"normal",body:{type:"tabpanel",tabs:function(n,t){for(var e=n.length,o=new Array(e),r=0;r<e;r++){var i=n[r];o[r]=t(i,r)}return o}(t.listCategories(),(function(n){return{title:n,name:n,items:[l,s]}}))},initialData:i,onTabChange:function(n,t){a.set(t.newTabName),c.throttle(n)},onChange:c.throttle,onAction:function(t,e){var o,r;"results"===e.name&&(o=n,r=e.value,o.insertContent(r),t.close())},buttons:[{type:"cancel",text:"Close",primary:!0}]}},m=n.windowManager.open(f());m.focus(x),t.hasLoaded()||(m.block("Loading emoticons..."),t.waitForLoad().then((function(){m.redial(f()),c.throttle(m),m.focus(x),m.unblock()}))["catch"]((function(n){m.redial({title:"Emoticons",body:{type:"panel",items:[{type:"alertbanner",level:"error",icon:"warning",text:"<p>Could not load emoticons</p>"}]},buttons:[{type:"cancel",text:"Close",primary:!0}],initialData:{pattern:"",results:[]}}),m.focus(x),m.unblock()})))};r.add("emoticons",(function(n,t){var e,o,r,i,u,a,c,l=(o=t,(e=n).getParam("emoticons_database_url",o+"/js/emojis"+e.suffix+".js")),s=n.getParam("emoticons_database_id","tinymce.plugins.emoticons","string"),f=_(n,l,s);i=f,u=function(){return L(r,i)},(r=n).ui.registry.addButton("emoticons",{tooltip:"Emoticons",icon:"emoji",onAction:u}),r.ui.registry.addMenuItem("emoticons",{text:"Emoticons...",icon:"emoji",onAction:u}),c=f,(a=n).ui.registry.addAutocompleter("emoticons",{ch:":",columns:"auto",minChars:2,fetch:function(n,t){return c.waitForLoad().then((function(){var e=c.listAll();return P(e,n,y.some(t))}))},onAction:function(n,t,e){a.selection.setRng(t),a.insertContent(e),n.hide()}})}))}();